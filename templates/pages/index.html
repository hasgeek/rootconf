{% extends theme('layouts/page.html') %}

{% block content %}
  {% include theme("sections/announcement.html") %}
  {% if node.properties.past_editions %}
    {% include theme("sections/past-editions.html") %}
  {% endif %}
  {% if node.properties.featured_talks %}
    {% include theme("sections/featured-talks.html") %}
  {% endif %}
  {% if node.properties.workshops %}
    {% include theme("sections/workshops.html") %}
  {% endif %}
  {% if node.properties.runup_events_list %}
    {% include theme("sections/runup-events-list.html") %}
  {% endif %}
  {% if node.properties.proposals %}
    {% include theme("sections/proposals.html") %}
  {% endif %}
  {% if node.properties.schedule %}
    {% include theme("sections/schedule.html") %}
  {% endif %}
  {% if node.properties.tickets %}
    {% include theme("sections/tickets.html") %}
  {% endif %}
  {% include theme("sections/venue.html") %}
  {% include theme("sections/sponsors-summary.html") %}
{% endblock %}


{% block navtype %}
<div id="nav-home">
  <nav class="navbar navbar-default" id="site-nav" role="navigation">
    <div class="sitebar">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand smooth-scroll" href="#header">Rootconf</a>
      </div>

      <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav">
          <li><a href="#annoucements" class="smooth-scroll">Announcements</a></li>
          {% if node.properties.past_editions %}
            <li><a href="#past-editions" class="smooth-scroll">Past editions</a></li>
          {% endif %}
          {% if node.properties.featured_talks %}
            <li><a href="#featured-talks" class="smooth-scroll">Featured talks</a></li>
          {% endif %}
          {% if node.properties.workshops %}
            <li><a href="#workshops" class="smooth-scroll">Workshops</a></li>
          {% endif %}
          {% if node.properties.runup_events_list %}
            <li><a href="#runup-events" class="smooth-scroll">Runup events</a></li>
          {% endif %}
          {% if node.properties.proposals %}
            <li><a href="#proposals" class="smooth-scroll">Proposals</a></li>
          {% endif %}
          {% if node.properties.schedule %}
            <li><a href="#schedule" class="smooth-scroll">Schedule</a></li>
          {% endif %}
          {% if node.properties.tickets %}
            <li><a href="#tickets" class="smooth-scroll">Tickets</a></li>
          {% endif %}
          <li><a href="#venue" class="smooth-scroll">Venue</a></li>
          <li><a href="#sponsors" class="smooth-scroll">Sponsors</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
            <ul class="dropdown-menu">   
              <li><a href="#about" class="smooth-scroll">About HasGeek</a></li>
              <li><a href="code-of-conduct">Code of conduct</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</div>
{% endblock %}

{% block banner %}
<header class="masthead-home fill-dark" id="header">
  <div id="lamp">
    <div id="wire"></div>
      <div id="holder"></div>
      <div id="bulb"></div>
      <div id="light"></div>
  </div>
  
  <div class="display-board-container">

    <div class="display-board push-one">
      <div class="white extralarge text-center">
        <div class="link line2 text-center title-type push-2q-top">
          <a class="logo silent link-silent" href="/"><img src="https://imgee.s3.amazonaws.com/imgee/769dc463009d4cf09be7352c8c7b3628.png" width="80px" alt="###">rootconf</a>
        </div>
        <p class="secondary prose-type space-half-top">
          {% if node.properties.tagline %}
            {{ node.properties.tagline }}
          {% else %}
            Conference &amp; Workshops on DevOps and Cloud Infrastructure
          {% endif %}
        </p>
        <div class="intro row-fluid secondary prose prose-type thin space-half-top text-center">
          <p class="nospace">
            {% if node.properties.date %}
              {{ node.properties.date }}
            {% endif %}
          </p>
        </div>
        <div class="intro row-fluid secondary prose prose-type thin space-half-top text-center">
          <p class="nospace">
            {% if node.properties.venue %}
              {{ node.properties.venue }}
            {% else %}
              MLR Convention Centre, JP Nagar
            {% endif %}
          </p>
        </div>
      </div>
      {% if node.properties.buy_ticket %}
        <div class="push-one text-center">
          <a href="#tickets" class="button smooth-scroll">Buy tickets</a>
        </div>
      {% elif node.properties.propose_talk %}
        <div class="push-one text-center">
          <a href="{{ node.properties.funnel_url }}" class="button" target="_blank">Propose a talk</a>
        </div>
      {% endif %}
    </div> 

    <div id="mast-img"></div> 
    <div id="mast-floor">
      <div class="masthead-test">
        <img src="https://imgee.s3.amazonaws.com/imgee/ae4c466819ce4701bbdb851b8988ed1e_w992_h225.jpeg" alt="">
      </div>
    </div> 
    <p class="large white scroll-down link-silent nospace text-right pad-two"><a href="#annoucements" class="smooth-scroll fa fa-chevron-down visible-lg white"></a></p>

  </div>
</header>
{% endblock %}

{% block footerscripts %}
<style type="text/css">        
  #boxoffice-widget .boxoffice-button-action {        
    background-color: #E05F26;        
    border-color:  #B94C1D;       
    color: #fff;        
  }       
  #boxoffice-widget .boxoffice-button-info {        
    background-color: #5BC0DE;        
    border-color: #2A9CBE;        
    color: #fff;        
  }       
  #boxoffice-widget .payment-stages-bg {        
    background-color: #463850;        
  }       
  #boxoffice-widget .progress-indicator>li {        
    color: #bbb;        
  }       
  #boxoffice-widget .category-heading {       
    background-color: #f0a40c;        
    border-bottom: 3px solid #d5920d;       
    color: #fff;     
    line-height: 1.1;     
  }       
  #boxoffice-widget .category-heading:after {       
    border-color: #f0a40c #fff #f0a40c #f0a40c; 
  }   
</style> 

<script>
$(document).ready(function() {  
  var boxofficeUrl = "https://boxoffice.hasgeek.com";

  $.get({
    url: boxofficeUrl + "/api/1/boxoffice.js",   
    crossDomain: true,
    timeout: 8000,
    retries: 5,
    retryInterval: 8000,
    success: function(data) {
      var boxofficeScript = document.createElement('script');
      boxofficeScript.innerHTML = data.script;
      document.getElementsByTagName('body')[0].appendChild(boxofficeScript);
      window.Boxoffice.init({
        org: "hasgeek",
        itemCollection: "{{ node.properties.item_collection }}",
        paymentDesc: "{{ node.properties.payment_desc }}"
      });
      loadProposals();
      initLeaflets();
    },
    error: function(response) {
      var ajaxLoad = this;
      ajaxLoad.retries -= 1;
      var errorMsg;
      if (response.readyState === 4) {
        errorMsg = "Server error, please try again later.";
        logError(errorMsg);
      }
      else if (response.readyState === 0) {
        if (ajaxLoad.retries < 0) {
          if(!navigator.onLine) {
            errorMsg = "Unable to connect. There is no network!";
            logError(errorMsg);
          }
          else {
            errorMsg = "<p>Unable to connect. If you are behind a firewall or using any script blocking extension (like Privacy Badger).<p></p> Please ensure your browser can load boxoffice.hasgeek.com, api.razorpay.com and checkout.razorpay.com .</p>";
            logError(errorMsg);
          }
        } else {
          setTimeout(function() {
            $.get(ajaxLoad);
          }, ajaxLoad.retryInterval);
        }
      }
    }
  });

  var logError = function (errorMsg) {
    $('#boxoffice-widget p').html(errorMsg);
    {% if g.user %}
      Raven.setUserContext({
        email: "{{ g.user.email }}",
        id: "{{ g.user.username }}"
      });
    {% endif %}
    Raven.captureMessage(errorMsg, {
      level: 'error',
      logger: 'boxoffice'
    });
    Rootconf.sendGA('error', 'boxoffice load error', errorMsg);
    loadProposals();
    initLeaflets();
  }

  var loadProposals = function () {
    // For conference and workshop schedule
    var funnelurl = "{{ node.properties.funnel_url }}" + "schedule/json";
    //If schedule divs are present on the page, then make the ajax call.
    if(($('#conferenceschedule').length) || ($('#workshopschedule').length)) {
      $.ajax({
        type: 'GET',
        dataType: 'jsonp',
        url: funnelurl,
        success: function(data) {
          parseJson(data, 'conference', '#conferenceschedule');
        }
      });//eof ajax call
    }

      // For proposals
    var proposals_url = "{{ node.properties.funnel_url }}" + 'json';

    //If funnel-proposals divs is present on the page, then make the ajax call.
    if(($('#funnel-proposals').length)) {
      $.ajax({
        type: 'GET',
        dataType: 'jsonp',
        url: proposals_url,
        success: function(data) {
          parseProposalJson(data);
        }
      });//eof ajax call
    }
  }

});
</script>
{% endblock %}
