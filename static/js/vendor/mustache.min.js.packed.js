(function(t,e){typeof exports=="object"&&exports&&typeof exports.nodeName!="string"?e(exports):typeof define=="function"&&define.amd?define(["exports"],e):(t.Mustache={},e(Mustache))})(this,function(t){function e(t){return typeof t=="function"}function n(t){return v(t)?"array":typeof t}function r(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(t,e){return t!=null&&typeof t=="object"&&e in t}function o(t,e){return g.call(t,e)}function s(t){return!o(y,t)}function a(t){return(t+"").replace(/[&<>"'\/]/g,function(t){return w[t]})}function u(e,n){function i(){if(y&&!w)while(g.length)delete d[g.pop()];else g=[];y=!1,w=!1}function o(t){if(typeof t=="string"&&(t=t.split(b,2)),!v(t)||t.length!==2)throw Error("Invalid tags: "+t);a=RegExp(r(t[0])+"\\s*"),u=RegExp("\\s*"+r(t[1])),h=RegExp("\\s*"+r("}"+t[1]))}if(!e)return[];var a,u,h,f=[],d=[],g=[],y=!1,w=!1;o(n||t.tags);var U,T,j,V,C,S,A=new l(e);while(!A.eos()){if(U=A.pos,j=A.scanUntil(a))for(var I=0,R=j.length;R>I;++I)V=j.charAt(I),s(V)?g.push(d.length):w=!0,d.push(["text",V,U,U+1]),U+=1,V==="\n"&&i();if(!A.scan(a))break;if(y=!0,T=A.scan(E)||"name",A.scan(k),T==="="?(j=A.scanUntil(m),A.scan(m),A.scanUntil(u)):T==="{"?(j=A.scanUntil(h),A.scan(x),A.scanUntil(u),T="&"):j=A.scanUntil(u),!A.scan(u))throw Error("Unclosed tag at "+A.pos);if(C=[T,j,U,A.pos],d.push(C),T==="#"||T==="^")f.push(C);else if(T==="/"){if(S=f.pop(),!S)throw Error('Unopened section "'+j+'" at '+U);if(S[1]!==j)throw Error('Unclosed section "'+S[1]+'" at '+U)}else T==="name"||T==="{"||T==="&"?w=!0:T==="="&&o(j)}if(S=f.pop())throw Error('Unclosed section "'+S[1]+'" at '+A.pos);return p(c(d))}function c(t){for(var e,n,r=[],i=0,o=t.length;o>i;++i)e=t[i],e&&(e[0]==="text"&&n&&n[0]==="text"?(n[1]+=e[1],n[3]=e[3]):(r.push(e),n=e));return r}function p(t){for(var e,n,r=[],i=r,o=[],s=0,a=t.length;a>s;++s)switch(e=t[s],e[0]){case"#":case"^":i.push(e),o.push(e),i=e[4]=[];break;case"/":n=o.pop(),n[5]=e[2],i=o.length>0?o[o.length-1][4]:r;break;default:i.push(e)}return r}function l(t){this.string=t,this.tail=t,this.pos=0}function h(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function f(){this.cache={}}var d=Object.prototype.toString,v=Array.isArray||function(t){return d.call(t)==="[object Array]"},g=RegExp.prototype.test,y=/\S/,w={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},k=/\s*/,b=/\s+/,m=/\s*=/,x=/\s*\}/,E=/#|\^|\/|>|\{|&|=|!/;l.prototype.eos=function(){return this.tail===""},l.prototype.scan=function(t){var e=this.tail.match(t);if(!e||e.index!==0)return"";var n=e[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},l.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=e.length,e},h.prototype.push=function(t){return new h(t,this)},h.prototype.lookup=function(t){var n,r=this.cache;if(r.hasOwnProperty(t))n=r[t];else{var o,s,a=this,u=!1;while(a){if(t.indexOf(".")>0){n=a.view,o=t.split("."),s=0;while(n!=null&&o.length>s)s===o.length-1&&(u=i(n,o[s])),n=n[o[s++]]}else n=a.view[t],u=i(a.view,t);if(u)break;a=a.parent}r[t]=n}return e(n)&&(n=n.call(this.view)),n},f.prototype.clearCache=function(){this.cache={}},f.prototype.parse=function(t,e){var n=this.cache,r=n[t];return r==null&&(r=n[t]=u(t,e)),r},f.prototype.render=function(t,e,n){var r=this.parse(t),i=e instanceof h?e:new h(e);return this.renderTokens(r,i,n,t)},f.prototype.renderTokens=function(t,e,n,r){for(var i,o,s,a="",u=0,c=t.length;c>u;++u)s=void 0,i=t[u],o=i[0],o==="#"?s=this.renderSection(i,e,n,r):o==="^"?s=this.renderInverted(i,e,n,r):o===">"?s=this.renderPartial(i,e,n,r):o==="&"?s=this.unescapedValue(i,e):o==="name"?s=this.escapedValue(i,e):o==="text"&&(s=this.rawValue(i)),s!==void 0&&(a+=s);return a},f.prototype.renderSection=function(t,n,r,i){function o(t){return s.render(t,n,r)}var s=this,a="",u=n.lookup(t[1]);if(u){if(v(u))for(var c=0,p=u.length;p>c;++c)a+=this.renderTokens(t[4],n.push(u[c]),r,i);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")a+=this.renderTokens(t[4],n.push(u),r,i);else if(e(u)){if(typeof i!="string")throw Error("Cannot use higher-order sections without the original template");u=u.call(n.view,i.slice(t[3],t[5]),o),u!=null&&(a+=u)}else a+=this.renderTokens(t[4],n,r,i);return a}},f.prototype.renderInverted=function(t,e,n,r){var i=e.lookup(t[1]);return!i||v(i)&&i.length===0?this.renderTokens(t[4],e,n,r):void 0},f.prototype.renderPartial=function(t,n,r){if(r){var i=e(r)?r(t[1]):r[t[1]];return i!=null?this.renderTokens(this.parse(i),n,r,i):void 0}},f.prototype.unescapedValue=function(t,e){var n=e.lookup(t[1]);return n!=null?n:void 0},f.prototype.escapedValue=function(e,n){var r=n.lookup(e[1]);return r!=null?t.escape(r):void 0},f.prototype.rawValue=function(t){return t[1]},t.name="mustache.js",t.version="2.1.3",t.tags=["{{","}}"];var U=new f;t.clearCache=function(){return U.clearCache()},t.parse=function(t,e){return U.parse(t,e)},t.render=function(t,e,r){if(typeof t!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+n(t)+'" was given as the first '+"argument for mustache#render(template, view, partials)");return U.render(t,e,r)},t.to_html=function(n,r,i,o){var s=t.render(n,r,i);return e(o)?(o(s),void 0):s},t.escape=a,t.Scanner=l,t.Context=h,t.Writer=f});